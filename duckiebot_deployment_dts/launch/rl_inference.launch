<?xml version="1.0" encoding="utf-8"?>
<launch>
    <!-- DTS-compatible ROS launch file for RL inference -->
    
    <!-- Parameters -->
    <arg name="robot_name" default="$(env ROBOT_NAME)" />
    <arg name="model_path" default="/models/champion_model.pth" />
    <arg name="config_path" default="/config/enhanced_config.yml" />
    <arg name="inference_frequency" default="10" />
    <arg name="control_frequency" default="20" />
    <arg name="max_speed" default="0.5" />
    
    <!-- Namespace for robot-specific topics -->
    <group ns="$(arg robot_name)">
        
        <!-- RL Inference Bridge Node -->
        <node name="rl_inference_bridge" 
              pkg="duckiebot_rl_inference" 
              type="rl_inference_bridge.py" 
              output="screen"
              required="true">
            
            <param name="robot_name" value="$(arg robot_name)" />
            <param name="model_path" value="$(arg model_path)" />
            <param name="config_path" value="$(arg config_path)" />
            <param name="inference_frequency" value="$(arg inference_frequency)" />
            <param name="image_resize" value="[120, 160]" />
            <param name="max_inference_time" value="0.1" />
            <param name="enable_safety_checks" value="true" />
            
            <!-- Remap topics to match Duckiebot conventions -->
            <remap from="camera/image/compressed" to="camera_node/image/compressed" />
            <remap from="rl_commands" to="rl_inference/commands" />
            <remap from="inference_status" to="rl_inference/status" />
            
        </node>
        
        <!-- Duckiebot Control Node -->
        <node name="duckiebot_control" 
              pkg="duckiebot_rl_inference" 
              type="duckiebot_control_node.py" 
              output="screen"
              required="true">
            
            <param name="robot_name" value="$(arg robot_name)" />
            <param name="max_speed" value="$(arg max_speed)" />
            <param name="wheel_baseline" value="0.1" />
            <param name="wheel_radius" value="0.0318" />
            <param name="control_frequency" value="$(arg control_frequency)" />
            <param name="command_timeout" value="1.0" />
            <param name="smoothing_factor" value="0.7" />
            
            <!-- Remap topics to match Duckiebot conventions -->
            <remap from="rl_commands" to="rl_inference/commands" />
            <remap from="wheels_cmd" to="wheels_driver_node/wheels_cmd" />
            <remap from="car_cmd" to="car_cmd_switch_node/cmd" />
            <remap from="control_status" to="rl_control/status" />
            
        </node>
        
        <!-- Safety Monitor Node (optional) -->
        <node name="safety_monitor" 
              pkg="duckiebot_rl_inference" 
              type="safety_monitor.py" 
              output="screen">
            
            <param name="robot_name" value="$(arg robot_name)" />
            <param name="max_inference_time" value="0.15" />
            <param name="max_command_age" value="2.0" />
            
        </node>
        
    </group>
    
</launch>